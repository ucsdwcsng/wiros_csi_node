#!/bin/bash

cd "$(dirname "$0")"


BW=$1
if [ "$BW" = "" ]; then
  echo "Missing bandwidth"
  exit 1
fi
case $BW in
20)
  B=1
  ;;
40)
  B=2
  ;;
80)
  B=3
  ;;
160)
  B=4
  ;;
*)
  echo "Invalid bandwitdh"
  exit 1
  ;;
esac

NSS=$2
if [ "$NSS" = "" ]; then
  echo "Missing number of spatial streams"
  exit 1
fi


PERIOD=$3
if [ "$PERIOD" = "" ]; then
  PERIOD=10000
fi

IFACE=$4

MAC1=$5
MAC2=$6
MAC3=$7
MAC4=$8
MAC5=$9
MAC6=$10

T0=$(date +%s)
while true; do
./nexutil -I ${IFACE} -s 505 -b -l 574 -v `printf "\
\x${NSS}0\x00\x0${B}\x02\
\x88\x02\x20\x00\
\xff\xff\xff\xff\xff\xff\
\x${MAC1}\x${MAC2}\x${MAC3}\x${MAC4}\x${MAC5}\x${MAC6}\
\x00\x11\x22\x33\x44\x55\
\x00\x00\
\x00\x00\
\xaa\xaa\x03\x00\x00\x00\x08\x00\
\x45\x00\x00\x26\xc5\x16\x40\x00\x40\x11\
\xe0\x4a\xc0\xa8\x0a\x14\xc0\xa8\x0a\x01\
\x9a\x30\x0e\xfe\x00\x12\xa6\xcf\
\x66\x69\x63\x61\x70\x65\x6c\x6f\
\x73\x61
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\xde\xad\xbe\xef\
" | /usr//sbin/openssl enc -base64 | tr -d "\n"`
usleep $PERIOD
done

TF=$(date +%s)
echo Finished in $((TF - T0)) sec
